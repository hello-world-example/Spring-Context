<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="ConfigurableApplicationContext.refresh ç»§æ‰¿å…³ç³»  ConfigurableApplicationContext (org.springframework.context)  ApplicationContext (org.springframework.context)  EnvironmentCapable (org.springframework.core.env) ListableBeanFactory (org.springframework.beans.factory)  BeanFactory (org.springframework.beans.factory)   HierarchicalBeanFactory (org.springframework.beans.factory)  BeanFactory (org.springframework.beans.factory)   MessageSource (org.springframework.context) ApplicationEventPublisher (org.springframework.context) ResourcePatternResolver (org.springframework.core.io.support)  ResourceLoader (org.springframework.core.io)     Lifecycle (org.springframework.context) Closeable (java.io)  AutoCloseable (java.lang)      å®ç°å…³ç³»  ConfigurableApplicationContext (org.springframework.context)  .. AbstractApplicationContext (org.springframework.context.support)  GenericApplicationContext (org.springframework.context.support)  GenericXmlApplicationContext (org.springframework.context.support) StaticApplicationContext (org.springframework.context.support) GenericWebApplicationContext (org.springframework.web.context.support) AnnotationConfigApplicationContext (org.springframework.context.annotation)  ."><meta property="og:title" content="" />
<meta property="og:description" content="ConfigurableApplicationContext.refresh ç»§æ‰¿å…³ç³»  ConfigurableApplicationContext (org.springframework.context)  ApplicationContext (org.springframework.context)  EnvironmentCapable (org.springframework.core.env) ListableBeanFactory (org.springframework.beans.factory)  BeanFactory (org.springframework.beans.factory)   HierarchicalBeanFactory (org.springframework.beans.factory)  BeanFactory (org.springframework.beans.factory)   MessageSource (org.springframework.context) ApplicationEventPublisher (org.springframework.context) ResourcePatternResolver (org.springframework.core.io.support)  ResourceLoader (org.springframework.core.io)     Lifecycle (org.springframework.context) Closeable (java.io)  AutoCloseable (java.lang)      å®ç°å…³ç³»  ConfigurableApplicationContext (org.springframework.context)  .. AbstractApplicationContext (org.springframework.context.support)  GenericApplicationContext (org.springframework.context.support)  GenericXmlApplicationContext (org.springframework.context.support) StaticApplicationContext (org.springframework.context.support) GenericWebApplicationContext (org.springframework.web.context.support) AnnotationConfigApplicationContext (org.springframework.context.annotation)  ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://hello-world-example.github.io/Spring-Context/docs/spring-context/ConfigurableApplicationContext/" />
<meta property="article:modified_time" content="2021-02-10T11:02:45+08:00" />
<title>Configurable Application Context | Spring-Context</title>
<link rel="icon" href="/Spring-Context/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/Spring-Context/book.min.d436f463c9471cfab26a8b71cd2f50b6abf5225806391453da4ca111d1834fef.css" integrity="sha256-1Db0Y8lHHPqyaotxzS9Qtqv1IlgGORRT2kyhEdGDT&#43;8=">


<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/Spring-Context"><span>Spring-Context</span>
  </a>
</h2>












  <ul>
<li>
  <a href="/Spring-Context/docs/spring-context/ConfigurableApplicationContext/"class=active>ConfigurableApplicationContextğŸƒ</a></li>
</ul>
<ul>
<li><strong>Handlers</strong>
<ul>
<li><strong>ContextNamespaceHandler</strong>
<ul>
<li>
  <a href="/Spring-Context/docs/spring-context/handlers/ContextNamespaceHandler/component-scan/">_&lt;context:component-scan/&gt;</a></li>
<li>
  <a href="/Spring-Context/docs/spring-context/handlers/ContextNamespaceHandler/load-time-weaver/">&lt;context:load-time-weaver/&gt;</a></li>
<li>
  <a href="/Spring-Context/docs/spring-context/handlers/ContextNamespaceHandler/spring-configured/">&lt;context:spring-configured/&gt;</a></li>
</ul>
</li>
</ul>
</li>
</ul>










</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/Spring-Context/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Configurable Application Context</strong>

  <label for="toc-control">
    <img src="/Spring-Context/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#configurableapplicationcontextrefresh">ConfigurableApplicationContext.refresh</a>
      <ul>
        <li><a href="#ç»§æ‰¿å…³ç³»">ç»§æ‰¿å…³ç³»</a></li>
        <li><a href="#å®ç°å…³ç³»">å®ç°å…³ç³»</a></li>
        <li><a href="#abstractapplicationcontext">AbstractApplicationContext</a></li>
        <li><a href="#-refresh">â¤ refresh()</a></li>
        <li><a href="#preparerefresh-">prepareRefresh() â¤</a></li>
        <li><a href="#obtainfreshbeanfactory-">obtainFreshBeanFactory() â¤</a>
          <ul>
            <li><a href="#absrefreshableacrefreshbeanfactory">Abs..RefreshableA..C&hellip;refreshBeanFactory()</a></li>
          </ul>
        </li>
        <li><a href="#preparebeanfactory">prepareBeanFactory</a></li>
        <li><a href="#postprocessbeanfactory">postProcessBeanFactory</a>
          <ul>
            <li><a href="#staticwebapplicationcontextspring-web">StaticWebApplicationContext:spring-web</a></li>
            <li><a href="#genericwebapplicationcontextspring-web">GenericWebApplicationContext:spring-web</a></li>
            <li><a href="#abstractrefreshablewebapplicationcontextspring-web">AbstractRefreshableWebApplicationContext:spring-web</a></li>
          </ul>
        </li>
        <li><a href="#invokebeanfactorypostprocessors-">invokeBeanFactoryPostProcessors â¤</a></li>
        <li><a href="#registerbeanpostprocessors">registerBeanPostProcessors</a>
          <ul>
            <li><a href="#registerbeanpostprocessors-1">registerBeanPostProcessorsï¼Ÿï¼Ÿï¼Ÿ</a></li>
          </ul>
        </li>
        <li><a href="#initmessagesource">initMessageSource</a></li>
        <li><a href="#initapplicationeventmulticaster">initApplicationEventMulticaster</a></li>
        <li><a href="#onrefresh">onRefresh</a></li>
        <li><a href="#registerlisteners">registerListeners()</a></li>
        <li><a href="#finishbeanfactoryinitialization-">finishBeanFactoryInitialization â¤</a>
          <ul>
            <li><a href="#preinstantiatesingletons">preInstantiateSingletons</a></li>
          </ul>
        </li>
        <li><a href="#finishrefresh">finishRefresh</a>
          <ul>
            <li><a href="#initlifecycleprocessor">initLifecycleProcessor</a></li>
          </ul>
        </li>
        <li><a href="#destroybeans">destroyBeans()</a>
          <ul>
            <li><a href="#destroysingleton">destroySingleton</a></li>
            <li><a href="#destroybean">destroyBean</a></li>
          </ul>
        </li>
        <li><a href="#cancelrefreshex">cancelRefresh(ex)</a></li>
        <li><a href="#resetcommoncaches">resetCommonCaches()</a></li>
        <li><a href="#å°ç»“">å°ç»“</a></li>
        <li><a href="#read-more">Read More</a></li>
      </ul>
    </li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="configurableapplicationcontextrefresh">ConfigurableApplicationContext.refresh</h1>
<h2 id="ç»§æ‰¿å…³ç³»">ç»§æ‰¿å…³ç³»</h2>
<ul>
<li><strong>ConfigurableApplicationContext</strong> (org.springframework.<strong>context</strong>)
<ul>
<li><strong>ApplicationContext</strong> (org.springframework.<strong>context</strong>)
<ul>
<li>EnvironmentCapable (org.springframework.<strong>core</strong>.env)</li>
<li><strong>ListableBeanFactory</strong> (org.springframework.<strong>beans</strong>.factory)
<ul>
<li><strong>BeanFactory</strong> (org.springframework.<strong>beans</strong>.factory)</li>
</ul>
</li>
<li><strong>HierarchicalBeanFactory</strong> (org.springframework.<strong>beans</strong>.factory)
<ul>
<li><strong>BeanFactory</strong> (org.springframework.<strong>beans</strong>.factory)</li>
</ul>
</li>
<li>MessageSource (org.springframework.<strong>context</strong>)</li>
<li>ApplicationEventPublisher (org.springframework.<strong>context</strong>)</li>
<li>ResourcePatternResolver (org.springframework.<strong>core</strong>.io.support)
<ul>
<li>ResourceLoader (org.springframework.<strong>core</strong>.io)</li>
</ul>
</li>
</ul>
</li>
<li>Lifecycle (org.springframework.<strong>context</strong>)</li>
<li>Closeable (java.io)
<ul>
<li>AutoCloseable (java.lang)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="å®ç°å…³ç³»">å®ç°å…³ç³»</h2>
<ul>
<li>ConfigurableApplicationContext (org.springframework.context)
<ul>
<li>..</li>
<li><strong>AbstractApplicationContext</strong> (org.springframework.context.support)
<ul>
<li><strong>GenericApplicationContext</strong> (org.springframework.context.support)
<ul>
<li>GenericXmlApplicationContext (org.springframework.context.support)</li>
<li>StaticApplicationContext (org.springframework.context.support)</li>
<li>GenericWebApplicationContext (org.springframework.web.context.support)</li>
<li><strong>AnnotationConfigApplicationContext</strong> (org.springframework.context.annotation)
<ul>
<li>..</li>
</ul>
</li>
</ul>
</li>
<li><strong>AbstractRefreshableApplicationContext</strong> (org.springframework.context.support)
<ul>
<li>AbstractRefreshableConfigApplicationContext (org.springframework.context.support)
<ul>
<li>AbstractXmlApplicationContext (org.springframework.context.support)
<ul>
<li><strong>FileSystemXmlApplicationContext</strong> (org.springframework.context.support)</li>
<li><strong>ClassPathXmlApplicationContext</strong> (org.springframework.context.support)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="abstractapplicationcontext">AbstractApplicationContext</h2>
<p><code>ConfigurableApplicationContext</code> æœ€é‡è¦çš„å®ç°æ˜¯ <code>AbstractApplicationContext</code>ï¼Œå…¶æœ€é‡è¦çš„æ–¹æ³•åˆæ˜¯ <code>refresh</code> æ–¹æ³•ï¼Œæ˜¯ <strong>Spring å¯åŠ¨è¿‡ç¨‹çš„ä¸»è¦æµç¨‹</strong></p>
<h2 id="-refresh">â¤ refresh()</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">refresh</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> BeansException<span style="color:#f92672">,</span> IllegalStateException <span style="color:#f92672">{</span>
  <span style="color:#75715e">// refresh å’Œ destroy çš„æ—¶å€™ç”¨åˆ°ï¼Œç¡®ä¿ä¸ä¼šåŒæ—¶æ‰§è¡Œ
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">startupShutdownMonitor</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// å‡†å¤‡å·¥ä½œï¼Œä¾‹å¦‚ ã€åˆå§‹åŒ–ç¯å¢ƒã€ã€é‡ç½® ç›‘å¬å™¨å’Œäº‹ä»¶ã€..
</span><span style="color:#75715e"></span>    prepareRefresh<span style="color:#f92672">();</span>

    <span style="color:#75715e">// é€šçŸ¥å­ç±»åˆ·æ–° BeanFactoryï¼Œä» xml æˆ– æ³¨è§£ä¸­æ‰«æ beanï¼Œå®Œæˆå¯¹ bean çš„æ³¨å†Œ
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//1. destroyBeans é”€æ¯ beans
</span><span style="color:#75715e"></span>    <span style="color:#75715e">//2. æ‰«ææ³¨å†Œ Bean ï¼šAbstractRefreshableApplicationContext#refreshBeanFactory#loadBeanDefinitions 
</span><span style="color:#75715e"></span>    ConfigurableListableBeanFactory beanFactory <span style="color:#f92672">=</span> obtainFreshBeanFactory<span style="color:#f92672">();</span>

    <span style="color:#75715e">// å¯¹ beanFactory åšä¸€äº›è®¾ç½®ï¼Œä¾‹å¦‚ ç±»åŠ è½½å™¨ã€spelè§£æå™¨ã€BeanPostProcessorã€é»˜è®¤ Bean (Env) æ³¨å†Œç­‰
</span><span style="color:#75715e"></span>    prepareBeanFactory<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">);</span>

    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
      <span style="color:#75715e">// æ²¡æœ‰å®ç°ï¼Œå­ç±»ï¼ˆwebæ¨¡å—ï¼‰æ ¹æ®è‡ªå·±çš„åŠŸèƒ½ å¢åŠ  BeanPostProcessor
</span><span style="color:#75715e"></span>      postProcessBeanFactory<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">);</span>

      <span style="color:#75715e">// æ‰§è¡Œ BeanFactoryPostProcessor åç½®å¤„ç†å™¨ï¼Œã€æ­¤æ—¶ bean è¿˜æ²¡æœ‰å®ä¾‹åŒ–ã€
</span><span style="color:#75715e"></span>      invokeBeanFactoryPostProcessors<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">);</span>

      <span style="color:#75715e">// å°†æ‰€æœ‰çš„ bean çš„åç½®å¤„ç†å™¨æ’å¥½åºï¼Œä½†ä¸ä¼šé©¬ä¸Šç”¨ï¼Œbean å®ä¾‹åŒ–ä¹‹åä¼šç”¨åˆ°
</span><span style="color:#75715e"></span>      registerBeanPostProcessors<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">);</span>

      <span style="color:#75715e">// å›½é™…åŒ–æœåŠ¡
</span><span style="color:#75715e"></span>      initMessageSource<span style="color:#f92672">();</span>

      <span style="color:#75715e">// åˆå§‹åŒ–äº‹ä»¶å¹¿æ’­å™¨ï¼ŒSimpleApplicationEventMulticaster
</span><span style="color:#75715e"></span>      initApplicationEventMulticaster<span style="color:#f92672">();</span>

      <span style="color:#75715e">/// æ²¡æœ‰å®ç°ï¼Œå­ç±»å®ç°ç”¨äºé€šçŸ¥
</span><span style="color:#75715e"></span>      onRefresh<span style="color:#f92672">();</span>

      <span style="color:#75715e">// æ³¨å†Œä¸€éƒ¨åˆ†ç‰¹æ®Šçš„äº‹ä»¶ç›‘å¬å™¨ï¼Œå‰©ä¸‹çš„åªæ˜¯å‡†å¤‡å¥½åå­—ï¼Œç­‰ Bean å®ä¾‹åŒ–å®Œæˆåå†æ³¨å†Œ
</span><span style="color:#75715e"></span>      registerListeners<span style="color:#f92672">();</span>

      <span style="color:#75715e">//  é€šè¿‡ getBean çš„æ–¹å¼åˆå§‹åŒ– å•ä¾‹ Bean
</span><span style="color:#75715e"></span>      finishBeanFactoryInitialization<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">);</span>

      <span style="color:#75715e">// ç”Ÿå‘½å‘¨æœŸç›‘å¬å™¨çš„å›è°ƒï¼Œå¹¿æ’­é€šçŸ¥ 
</span><span style="color:#75715e"></span>      finishRefresh<span style="color:#f92672">();</span>
      
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>BeansException ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#f92672">...</span>

      <span style="color:#75715e">// Destroy already created singletons to avoid dangling resources.
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// åˆ·æ–°å¤±è´¥åçš„å¤„ç†ï¼Œä¸»è¦æ˜¯å°†ä¸€äº›ä¿å­˜ç¯å¢ƒä¿¡æ¯çš„é›†åˆåšæ¸…ç†
</span><span style="color:#75715e"></span>      destroyBeans<span style="color:#f92672">();</span>

      <span style="color:#75715e">// applicationContextæ˜¯å¦å·²ç»æ¿€æ´»çš„æ ‡å¿—ï¼Œè®¾ç½®ä¸ºfalse
</span><span style="color:#75715e"></span>      cancelRefresh<span style="color:#f92672">(</span>ex<span style="color:#f92672">);</span>

      <span style="color:#66d9ef">throw</span> ex<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">finally</span> <span style="color:#f92672">{</span>
      <span style="color:#75715e">// Reset common introspection caches in Spring&#39;s core, since we
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// might not ever need metadata for singleton beans anymore...
</span><span style="color:#75715e"></span>      resetCommonCaches<span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="preparerefresh-">prepareRefresh() â¤</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">prepareRefresh</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">startupDate</span> <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">currentTimeMillis</span><span style="color:#f92672">();</span>
  <span style="color:#75715e">// è®¾ç½®æ ‡å¿—ä½
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">closed</span><span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
  <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">active</span><span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>

  <span style="color:#f92672">..</span> <span style="color:#75715e">// æ‰“å°è°ƒè¯•æ—¥å¿—
</span><span style="color:#75715e"></span>
  <span style="color:#75715e">// ã€â¤æ‰©å±•â¤ã€é»˜è®¤æ²¡æœ‰å®ç°ï¼Œ åœ¨ Web ç¯å¢ƒä¸‹ç”¨æ¥ä¿å­˜ ServletContext
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// WebApplicationContextUtils.initServletPropertySources(..,servletContext,servletConfig);
</span><span style="color:#75715e"></span>  initPropertySources<span style="color:#f92672">();</span>

  <span style="color:#75715e">// åˆ›å»º Environment å¹¶æ ¡éªŒ 
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// spring-core: StandardEnvironment åŠ è½½ System.getProperties() å’Œ System.getenv()
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// spring-web: StandardServletEnvironment ä¿å­˜ ServletContext
</span><span style="color:#75715e"></span>  getEnvironment<span style="color:#f92672">().</span><span style="color:#a6e22e">validateRequiredProperties</span><span style="color:#f92672">();</span>

  <span style="color:#75715e">// é‡ç½® äº‹ä»¶ç›‘å¬å™¨å’Œäº‹ä»¶ï¼Œä¿ç•™ earlyApplicationListeners
</span><span style="color:#75715e"></span>  <span style="color:#f92672">...</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>TODO è¯¦è§ï¼š
<ul>
<li>spring-coreï¼š Environment link</li>
<li>spring-coreï¼š ConfigurableEnvironment link</li>
</ul>
</li>
</ul>
<h2 id="obtainfreshbeanfactory-">obtainFreshBeanFactory() â¤</h2>
<p>é€šçŸ¥å­ç±»åˆ·æ–° BeanFactoryï¼Œ<strong>ä» xml æˆ– æ³¨è§£ä¸­æ‰«æ beanï¼Œå®Œæˆå¯¹ bean çš„æ³¨å†Œ</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> ConfigurableListableBeanFactory <span style="color:#a6e22e">obtainFreshBeanFactory</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">// æŠ½è±¡æ–¹æ³•æ²¡æœ‰å®ç°ï¼Œ åœ¨å­ç±» AbstractRefreshableApplicationContext ä¸­æœ‰å®ç°
</span><span style="color:#75715e"></span>  refreshBeanFactory<span style="color:#f92672">();</span>
  <span style="color:#75715e">// æ²¡æœ‰å®ç°
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// GenericApplicationContext DefaultListableBeanFactory
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// AbstractRefreshableApplicationContext DefaultListableBeanFactory(getInternalParentBeanFactory())
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">return</span> getBeanFactory<span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="absrefreshableacrefreshbeanfactory">Abs..RefreshableA..C&hellip;refreshBeanFactory()</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    <span style="color:#75715e">// AbstractRefreshableApplicationContext
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">refreshBeanFactory</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> BeansException <span style="color:#f92672">{</span>
        <span style="color:#75715e">// BeanFactory å­˜åœ¨
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>hasBeanFactory<span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// åˆ™é”€æ¯ beansï¼Œæœ€åé”€æ¯æµç¨‹è¯¦ç»†è¯´æ˜
</span><span style="color:#75715e"></span>            destroyBeans<span style="color:#f92672">();</span>
            <span style="color:#75715e">// beanFactory å˜é‡ç½®ç©º
</span><span style="color:#75715e"></span>            closeBeanFactory<span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// â¤â¤â¤ DefaultListableBeanFactory â¤â¤â¤
</span><span style="color:#75715e"></span>            DefaultListableBeanFactory beanFactory <span style="color:#f92672">=</span> createBeanFactory<span style="color:#f92672">();</span>
            beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">setSerializationId</span><span style="color:#f92672">(</span>getId<span style="color:#f92672">());</span>
            <span style="color:#75715e">// beanFactory.setAllowBeanDefinitionOverriding
</span><span style="color:#75715e"></span>            <span style="color:#75715e">// beanFactory.setAllowCircularReferences
</span><span style="color:#75715e"></span>            customizeBeanFactory<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">);</span>
            <span style="color:#75715e">// ã€â¤â¤â¤æ‰©å±•â¤â¤â¤ã€æ‰«ææ³¨å†Œ Bean
</span><span style="color:#75715e"></span>            loadBeanDefinitions<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">beanFactoryMonitor</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">beanFactory</span> <span style="color:#f92672">=</span> beanFactory<span style="color:#f92672">;</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> ApplicationContextException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;I/O error parsing bean definition source for &#34;</span> <span style="color:#f92672">+</span> getDisplayName<span style="color:#f92672">(),</span> ex<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
</code></pre></div><p><strong>AbstractRefreshableApplicationContext.createBeanFactory()</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> DefaultListableBeanFactory <span style="color:#a6e22e">createBeanFactory</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> DefaultListableBeanFactory<span style="color:#f92672">(</span>getInternalParentBeanFactory<span style="color:#f92672">());</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><strong>?? AbstractApplicationContext.getInternalParentBeanFactory()</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> BeanFactory <span style="color:#a6e22e">getInternalParentBeanFactory</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">return</span> 
    getParent<span style="color:#f92672">()</span> <span style="color:#66d9ef">instanceof</span> ConfigurableApplicationContext
    <span style="color:#f92672">?</span> <span style="color:#f92672">((</span>ConfigurableApplicationContext<span style="color:#f92672">)</span> getParent<span style="color:#f92672">()).</span><span style="color:#a6e22e">getBeanFactory</span><span style="color:#f92672">()</span> 
    <span style="color:#f92672">:</span> getParent<span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="preparebeanfactory">prepareBeanFactory</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">prepareBeanFactory</span><span style="color:#f92672">(</span>ConfigurableListableBeanFactory beanFactory<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">// å‘Šè¯‰ beanfactory ä¸Šä¸‹æ–‡çš„ç±»åŠ è½½å™¨
</span><span style="color:#75715e"></span>  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">setBeanClassLoader</span><span style="color:#f92672">(</span>getClassLoader<span style="color:#f92672">());</span>
  <span style="color:#75715e">// è®¾ç½®è§£æå™¨ï¼Œç”¨äºè§£æ bean çš„å®šä¹‰ä¸­å‡ºç°çš„ Spel è¡¨è¾¾å¼
</span><span style="color:#75715e"></span>  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">setBeanExpressionResolver</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> StandardBeanExpressionResolver<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getBeanClassLoader</span><span style="color:#f92672">()));</span>
  <span style="color:#75715e">// è®¾ç½®è‡ªå®šä¹‰çš„è½¬æ¢å™¨ï¼Œç”¨ä½œ å­—ç¬¦ä¸²å’Œå¯¹è±¡ ä¹‹é—´çš„ç±»å‹è½¬æ¢ï¼ˆå¦‚ï¼šxml ä¸­çš„é…ç½®ï¼‰
</span><span style="color:#75715e"></span>  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">addPropertyEditorRegistrar</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ResourceEditorRegistrar<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> getEnvironment<span style="color:#f92672">()));</span>

  <span style="color:#75715e">// å¢åŠ åç½®å¤„ç†å™¨ ApplicationContextAwareProcessor
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// å¦‚æœ bean å®ç°ä»¥ä¸‹æ¥å£ï¼Œå°†åœ¨ BeanPostProcessor æµç¨‹ä¸­ æ³¨å…¥æŒ‡å®šçš„å¯¹è±¡
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// EnvironmentAware
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// EmbeddedValueResolverAware
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// ResourceLoaderAware 
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// ApplicationEventPublisherAware
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// MessageSourceAware 
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// ApplicationContextAware
</span><span style="color:#75715e"></span>  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">addBeanPostProcessor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ApplicationContextAwareProcessor<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">));</span>
  <span style="color:#75715e">// bean åœ¨åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå¦‚æœ bean æ˜¯ä»¥ä¸‹æ¥å£çš„å®ç°ï¼Œåˆ™ä¸è¿›è¡Œæ³¨å…¥
</span><span style="color:#75715e"></span>  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">ignoreDependencyInterface</span><span style="color:#f92672">(</span>EnvironmentAware<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">ignoreDependencyInterface</span><span style="color:#f92672">(</span>EmbeddedValueResolverAware<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">ignoreDependencyInterface</span><span style="color:#f92672">(</span>ResourceLoaderAware<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">ignoreDependencyInterface</span><span style="color:#f92672">(</span>ApplicationEventPublisherAware<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">ignoreDependencyInterface</span><span style="color:#f92672">(</span>MessageSourceAware<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">ignoreDependencyInterface</span><span style="color:#f92672">(</span>ApplicationContextAware<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

  <span style="color:#75715e">// é’ˆå¯¹è¿™äº›ç±»å‹çš„ @Autowiredï¼Œè·å–çš„ç±»å‹å®ä¾‹
</span><span style="color:#75715e"></span>  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">registerResolvableDependency</span><span style="color:#f92672">(</span>BeanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> beanFactory<span style="color:#f92672">);</span>
  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">registerResolvableDependency</span><span style="color:#f92672">(</span>ResourceLoader<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">registerResolvableDependency</span><span style="color:#f92672">(</span>ApplicationEventPublisher<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">registerResolvableDependency</span><span style="color:#f92672">(</span>ApplicationContext<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>

  <span style="color:#75715e">// @since 4.3.4
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// æ³¨å†Œ ApplicationListener äº‹ä»¶ç›‘å¬å™¨
</span><span style="color:#75715e"></span>  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">addBeanPostProcessor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ApplicationListenerDetector<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">));</span>

  <span style="color:#75715e">// éƒ¨ç½²ä¸€ä¸ª bean çš„åç½®å¤„ç†å™¨ ApplicationContextAwareProcessorï¼Œç”¨äº AOP &#34;é™æ€&#34;ä»£ç†ç›¸å…³çš„å¤„ç†
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">containsBean</span><span style="color:#f92672">(</span>LOAD_TIME_WEAVER_BEAN_NAME<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
    beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">addBeanPostProcessor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> LoadTimeWeaverAwareProcessor<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">));</span>
    beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">setTempClassLoader</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ContextTypeMatchClassLoader<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getBeanClassLoader</span><span style="color:#f92672">()));</span>
  <span style="color:#f92672">}</span>

  <span style="color:#75715e">// æ³¨å†Œ Environment (ConfigurableApplicationContext.environment)
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">containsLocalBean</span><span style="color:#f92672">(</span>ENVIRONMENT_BEAN_NAME<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
    beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">registerSingleton</span><span style="color:#f92672">(</span>ENVIRONMENT_BEAN_NAME<span style="color:#f92672">,</span> getEnvironment<span style="color:#f92672">());</span>
  <span style="color:#f92672">}</span>
  <span style="color:#75715e">// æ³¨å†Œ SystemProperties (ConfigurableApplicationContext.systemProperties)
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">containsLocalBean</span><span style="color:#f92672">(</span>SYSTEM_PROPERTIES_BEAN_NAME<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
    beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">registerSingleton</span><span style="color:#f92672">(</span>SYSTEM_PROPERTIES_BEAN_NAME<span style="color:#f92672">,</span> getEnvironment<span style="color:#f92672">().</span><span style="color:#a6e22e">getSystemProperties</span><span style="color:#f92672">());</span>
  <span style="color:#f92672">}</span>
  <span style="color:#75715e">// SystemEnvironment (ConfigurableApplicationContext.systemEnvironment)
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">containsLocalBean</span><span style="color:#f92672">(</span>SYSTEM_ENVIRONMENT_BEAN_NAME<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
    beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">registerSingleton</span><span style="color:#f92672">(</span>SYSTEM_ENVIRONMENT_BEAN_NAME<span style="color:#f92672">,</span> getEnvironment<span style="color:#f92672">().</span><span style="color:#a6e22e">getSystemEnvironment</span><span style="color:#f92672">());</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="postprocessbeanfactory">postProcessBeanFactory</h2>
<ul>
<li><strong>AbstractApplicationContext</strong> (.<strong>context</strong>.support)
<ul>
<li>GenericApplicationContext (.context.support)
<ul>
<li>StaticApplicationContext (.context.support)
<ul>
<li><strong>StaticWebApplicationContext</strong> (.<strong>web</strong>.context.support)</li>
</ul>
</li>
<li><strong>GenericWebApplicationContext</strong> (.<strong>web</strong>.context.support)
<ul>
<li><strong>ServletWebServerApplicationContext</strong> (.<strong>boot.web</strong>.servlet.context)
<ul>
<li><strong>AnnotationConfigServletWebServerApplicationContext</strong> (.<strong>boot.web</strong>.servlet.context)</li>
</ul>
</li>
<li><strong>AnnotationConfigServletWebApplicationContext</strong> (<strong>.boot.web</strong>.servlet.context)</li>
</ul>
</li>
<li>GenericReactiveWebApplicationContext (.boot.web.reactive.context)
<ul>
<li>ReactiveWebServerApplicationContext (.boot.web.reactive.context)
<ul>
<li><strong>AnnotationConfigReactiveWebServerApplicationContext</strong> (**.boot.web.**reactive.context)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>AbstractRefreshableApplicationContext (.context.support)
<ul>
<li>AbstractRefreshableConfigApplicationContext (.context.support)
<ul>
<li><strong>AbstractRefreshableWebApplicationContext</strong> (.<strong>web</strong>.context.support)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="staticwebapplicationcontextspring-web">StaticWebApplicationContext:spring-web</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">postProcessBeanFactory</span><span style="color:#f92672">(</span>ConfigurableListableBeanFactory beanFactory<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">// ServletContextAware/ServletConfigAware åˆå§‹åŒ– bean çš„æ—¶å€™ï¼Œæ³¨å…¥æŒ‡å®šçš„å¯¹è±¡
</span><span style="color:#75715e"></span>  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">addBeanPostProcessor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ServletContextAwareProcessor<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">servletContext</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">servletConfig</span><span style="color:#f92672">));</span>
  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">ignoreDependencyInterface</span><span style="color:#f92672">(</span>ServletContextAware<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">ignoreDependencyInterface</span><span style="color:#f92672">(</span>ServletConfigAware<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

  WebApplicationContextUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">registerWebApplicationScopes</span><span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">servletContext</span><span style="color:#f92672">);</span>
  WebApplicationContextUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">registerEnvironmentBeans</span><span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">servletContext</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">servletConfig</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="genericwebapplicationcontextspring-web">GenericWebApplicationContext:spring-web</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">postProcessBeanFactory</span><span style="color:#f92672">(</span>ConfigurableListableBeanFactory beanFactory<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">servletContext</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// ServletContextAware/ServletConfigAware åˆå§‹åŒ– bean çš„æ—¶å€™ï¼Œæ³¨å…¥æŒ‡å®šçš„å¯¹è±¡
</span><span style="color:#75715e"></span>    beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">addBeanPostProcessor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ServletContextAwareProcessor<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">servletContext</span><span style="color:#f92672">));</span>
    beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">ignoreDependencyInterface</span><span style="color:#f92672">(</span>ServletContextAware<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
  WebApplicationContextUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">registerWebApplicationScopes</span><span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">servletContext</span><span style="color:#f92672">);</span>
  WebApplicationContextUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">registerEnvironmentBeans</span><span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">servletContext</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="abstractrefreshablewebapplicationcontextspring-web">AbstractRefreshableWebApplicationContext:spring-web</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">postProcessBeanFactory</span><span style="color:#f92672">(</span>ConfigurableListableBeanFactory beanFactory<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">addBeanPostProcessor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ServletContextAwareProcessor<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">servletContext</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">servletConfig</span><span style="color:#f92672">));</span>
  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">ignoreDependencyInterface</span><span style="color:#f92672">(</span>ServletContextAware<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">ignoreDependencyInterface</span><span style="color:#f92672">(</span>ServletConfigAware<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

  WebApplicationContextUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">registerWebApplicationScopes</span><span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">servletContext</span><span style="color:#f92672">);</span>
  WebApplicationContextUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">registerEnvironmentBeans</span><span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">servletContext</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">servletConfig</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="invokebeanfactorypostprocessors-">invokeBeanFactoryPostProcessors â¤</h2>
<ul>
<li>æ­¤æ—¶ Bean å·²ç»åœ¨ <code>obtainFreshBeanFactory</code> å®Œæˆæ‰«æçš„æ³¨å†Œï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å®ä¾‹åŒ–</li>
<li>ä¸è¦åœ¨è‡ªå·±æ‰©å±•çš„ <code>BeanFactoryPostProcessor</code> ä¸­è°ƒç”¨ä¼šè§¦å‘ Bean å®ä¾‹åŒ–çš„æ–¹æ³•ï¼Œå¦‚ï¼š
<ul>
<li><code>getBean</code></li>
<li><code>getBeansOfType</code></li>
</ul>
</li>
<li>å¤„ç† Bean çš„å®ä¾‹åº”åœ¨ <code>BeanPostProcessor</code> ä¸­è¿›è¡Œ</li>
<li><code>BeanFactoryPostProcessor</code> ä¸»è¦ç”¨æ¥ <strong>ä¿®æ”¹ <code>BeanDefinition</code></strong> æˆ– <strong>æ³¨å†Œæ›´å¤šçš„ <code>BeanDefinition</code></strong></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">invokeBeanFactoryPostProcessors</span><span style="color:#f92672">(</span>ConfigurableListableBeanFactory beanFactory<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    PostProcessorRegistrationDelegate<span style="color:#f92672">.</span><span style="color:#a6e22e">invokeBeanFactoryPostProcessors</span><span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">,</span> getBeanFactoryPostProcessors<span style="color:#f92672">());</span>

    <span style="color:#75715e">// Detect a LoadTimeWeaver and prepare for weaving, if found in the meantime
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// (e.g. through an @Bean method registered by ConfigurationClassPostProcessor)
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getTempClassLoader</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">containsBean</span><span style="color:#f92672">(</span>LOAD_TIME_WEAVER_BEAN_NAME<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">addBeanPostProcessor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> LoadTimeWeaverAwareProcessor<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">));</span>
        beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">setTempClassLoader</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ContextTypeMatchClassLoader<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getBeanClassLoader</span><span style="color:#f92672">()));</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><h2 id="registerbeanpostprocessors">registerBeanPostProcessors</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">registerBeanPostProcessors</span><span style="color:#f92672">(</span>ConfigurableListableBeanFactory beanFactory<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  PostProcessorRegistrationDelegate<span style="color:#f92672">.</span><span style="color:#a6e22e">registerBeanPostProcessors</span><span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="registerbeanpostprocessors-1">registerBeanPostProcessorsï¼Ÿï¼Ÿï¼Ÿ</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">registerBeanPostProcessors</span><span style="color:#f92672">(</span>
  ConfigurableListableBeanFactory beanFactory<span style="color:#f92672">,</span> AbstractApplicationContext applicationContext<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

  String<span style="color:#f92672">[]</span> postProcessorNames <span style="color:#f92672">=</span> beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getBeanNamesForType</span><span style="color:#f92672">(</span>BeanPostProcessor<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>

  <span style="color:#75715e">// Register BeanPostProcessorChecker that logs an info message when
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// a bean is created during BeanPostProcessor instantiation, i.e. when
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// a bean is not eligible for getting processed by all BeanPostProcessors.
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">int</span> beanProcessorTargetCount <span style="color:#f92672">=</span> beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getBeanPostProcessorCount</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> 1 <span style="color:#f92672">+</span> postProcessorNames<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span>
  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">addBeanPostProcessor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> BeanPostProcessorChecker<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">,</span> beanProcessorTargetCount<span style="color:#f92672">));</span>

  <span style="color:#75715e">// Separate between BeanPostProcessors that implement PriorityOrdered,
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// Ordered, and the rest.
</span><span style="color:#75715e"></span>  List<span style="color:#f92672">&lt;</span>BeanPostProcessor<span style="color:#f92672">&gt;</span> priorityOrderedPostProcessors <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
  List<span style="color:#f92672">&lt;</span>BeanPostProcessor<span style="color:#f92672">&gt;</span> internalPostProcessors <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
  List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> orderedPostProcessorNames <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
  List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> nonOrderedPostProcessorNames <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;();</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String ppName <span style="color:#f92672">:</span> postProcessorNames<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">isTypeMatch</span><span style="color:#f92672">(</span>ppName<span style="color:#f92672">,</span> PriorityOrdered<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
      BeanPostProcessor pp <span style="color:#f92672">=</span> beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getBean</span><span style="color:#f92672">(</span>ppName<span style="color:#f92672">,</span> BeanPostProcessor<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
      priorityOrderedPostProcessors<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>pp<span style="color:#f92672">);</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>pp <span style="color:#66d9ef">instanceof</span> MergedBeanDefinitionPostProcessor<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        internalPostProcessors<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>pp<span style="color:#f92672">);</span>
      <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">isTypeMatch</span><span style="color:#f92672">(</span>ppName<span style="color:#f92672">,</span> Ordered<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
      orderedPostProcessorNames<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>ppName<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
      nonOrderedPostProcessorNames<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>ppName<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>

  <span style="color:#75715e">// First, register the BeanPostProcessors that implement PriorityOrdered.
</span><span style="color:#75715e"></span>  sortPostProcessors<span style="color:#f92672">(</span>priorityOrderedPostProcessors<span style="color:#f92672">,</span> beanFactory<span style="color:#f92672">);</span>
  registerBeanPostProcessors<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">,</span> priorityOrderedPostProcessors<span style="color:#f92672">);</span>

  <span style="color:#75715e">// Next, register the BeanPostProcessors that implement Ordered.
</span><span style="color:#75715e"></span>  List<span style="color:#f92672">&lt;</span>BeanPostProcessor<span style="color:#f92672">&gt;</span> orderedPostProcessors <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;(</span>orderedPostProcessorNames<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String ppName <span style="color:#f92672">:</span> orderedPostProcessorNames<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    BeanPostProcessor pp <span style="color:#f92672">=</span> beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getBean</span><span style="color:#f92672">(</span>ppName<span style="color:#f92672">,</span> BeanPostProcessor<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    orderedPostProcessors<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>pp<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>pp <span style="color:#66d9ef">instanceof</span> MergedBeanDefinitionPostProcessor<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      internalPostProcessors<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>pp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
  sortPostProcessors<span style="color:#f92672">(</span>orderedPostProcessors<span style="color:#f92672">,</span> beanFactory<span style="color:#f92672">);</span>
  registerBeanPostProcessors<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">,</span> orderedPostProcessors<span style="color:#f92672">);</span>

  <span style="color:#75715e">// Now, register all regular BeanPostProcessors.
</span><span style="color:#75715e"></span>  List<span style="color:#f92672">&lt;</span>BeanPostProcessor<span style="color:#f92672">&gt;</span> nonOrderedPostProcessors <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;(</span>nonOrderedPostProcessorNames<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">());</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String ppName <span style="color:#f92672">:</span> nonOrderedPostProcessorNames<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    BeanPostProcessor pp <span style="color:#f92672">=</span> beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getBean</span><span style="color:#f92672">(</span>ppName<span style="color:#f92672">,</span> BeanPostProcessor<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    nonOrderedPostProcessors<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>pp<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>pp <span style="color:#66d9ef">instanceof</span> MergedBeanDefinitionPostProcessor<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      internalPostProcessors<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>pp<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
  registerBeanPostProcessors<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">,</span> nonOrderedPostProcessors<span style="color:#f92672">);</span>

  <span style="color:#75715e">// Finally, re-register all internal BeanPostProcessors.
</span><span style="color:#75715e"></span>  sortPostProcessors<span style="color:#f92672">(</span>internalPostProcessors<span style="color:#f92672">,</span> beanFactory<span style="color:#f92672">);</span>
  registerBeanPostProcessors<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">,</span> internalPostProcessors<span style="color:#f92672">);</span>

  <span style="color:#75715e">// Re-register post-processor for detecting inner beans as ApplicationListeners,
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// moving it to the end of the processor chain (for picking up proxies etc).
</span><span style="color:#75715e"></span>  beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">addBeanPostProcessor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ApplicationListenerDetector<span style="color:#f92672">(</span>applicationContext<span style="color:#f92672">));</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="initmessagesource"><del>initMessageSource</del></h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">initMessageSource</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  ConfigurableListableBeanFactory beanFactory <span style="color:#f92672">=</span> getBeanFactory<span style="color:#f92672">();</span>

  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">containsLocalBean</span><span style="color:#f92672">(</span>MESSAGE_SOURCE_BEAN_NAME<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// å¦‚æœå·²ç»æ³¨å†Œï¼Œå¹¶ä¸”æ˜¯ HierarchicalMessageSource hmsï¼Œ
</span><span style="color:#75715e"></span>    <span style="color:#f92672">...</span>
    hms<span style="color:#f92672">.</span><span style="color:#a6e22e">setParentMessageSource</span><span style="color:#f92672">(</span>getInternalParentMessageSource<span style="color:#f92672">())</span>
    <span style="color:#f92672">...</span>
  <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// å¦‚æœæ²¡æœ‰æ³¨å†Œï¼Œä½¿ç”¨ç©ºçš„ MessageSource 
</span><span style="color:#75715e"></span>    DelegatingMessageSource dms <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DelegatingMessageSource<span style="color:#f92672">();</span>
    dms<span style="color:#f92672">.</span><span style="color:#a6e22e">setParentMessageSource</span><span style="color:#f92672">(</span>getInternalParentMessageSource<span style="color:#f92672">());</span>
    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">messageSource</span> <span style="color:#f92672">=</span> dms<span style="color:#f92672">;</span>
    beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">registerSingleton</span><span style="color:#f92672">(</span>MESSAGE_SOURCE_BEAN_NAME<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">messageSource</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">...</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="initapplicationeventmulticaster"><del>initApplicationEventMulticaster</del></h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">initApplicationEventMulticaster</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
     ConfigurableListableBeanFactory beanFactory <span style="color:#f92672">=</span> getBeanFactory<span style="color:#f92672">();</span>
     <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">containsLocalBean</span><span style="color:#f92672">(</span>APPLICATION_EVENT_MULTICASTER_BEAN_NAME<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
       <span style="color:#75715e">// å¦‚æœæœ‰åˆ™è·å–
</span><span style="color:#75715e"></span>       <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">applicationEventMulticaster</span> <span style="color:#f92672">=</span> beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getBean</span><span style="color:#f92672">(</span>APPLICATION_EVENT_MULTICASTER_BEAN_NAME<span style="color:#f92672">,</span> ApplicationEventMulticaster<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
       <span style="color:#f92672">...</span>
		 	   <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
       <span style="color:#75715e">// æ²¡æœ‰åˆ™åˆ›å»º SimpleApplicationEventMulticaster
</span><span style="color:#75715e"></span>       <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">applicationEventMulticaster</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SimpleApplicationEventMulticaster<span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">);</span>
       beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">registerSingleton</span><span style="color:#f92672">(</span>APPLICATION_EVENT_MULTICASTER_BEAN_NAME<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">applicationEventMulticaster</span><span style="color:#f92672">);</span>
       <span style="color:#f92672">...</span>
     <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="onrefresh"><del>onRefresh</del></h2>
<p>å®ä¾‹åŒ– Bean ä¹‹å‰é€šçŸ¥å­ç±»åšä¸€äº›äº‹æƒ…ï¼ŒæŠŠå¤§éƒ¨åˆ†ä»ç„¶ä¸ <code>MessageSource</code> å›½é™…åŒ–æœ‰å…³</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onRefresh</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> BeansException <span style="color:#f92672">{</span>
  <span style="color:#75715e">// For subclasses: do nothing by default.
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// org.springframework.web.context.support.AbstractRefreshableWebApplicationContext
</span><span style="color:#75715e"></span><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onRefresh</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">themeSource</span> <span style="color:#f92672">=</span> UiApplicationContextUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">initThemeSource</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">//StaticWebApplicationContext
</span><span style="color:#75715e"></span><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onRefresh</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">themeSource</span> <span style="color:#f92672">=</span> UiApplicationContextUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">initThemeSource</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// GenericWebApplicationContext
</span><span style="color:#75715e"></span><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onRefresh</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">themeSource</span> <span style="color:#f92672">=</span> UiApplicationContextUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">initThemeSource</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext 
</span><span style="color:#75715e">// extends GenericWebApplicationContext
</span><span style="color:#75715e"></span><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">onRefresh</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">onRefresh</span><span style="color:#f92672">();</span>
  <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
    createWebServer<span style="color:#f92672">();</span>
  <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Throwable ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> ApplicationContextException<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Unable to start web server&#34;</span><span style="color:#f92672">,</span> ex<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="registerlisteners">registerListeners()</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">registerListeners</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">// æ³¨å†Œçš„éƒ½æ˜¯ç‰¹æ®Šçš„äº‹ä»¶ç›‘å¬å™¨ï¼Œè€Œå¹¶éé…ç½®ä¸­çš„ Listener
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>ApplicationListener<span style="color:#f92672">&lt;?&gt;</span> listener <span style="color:#f92672">:</span> getApplicationListeners<span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
    getApplicationEventMulticaster<span style="color:#f92672">().</span><span style="color:#a6e22e">addApplicationListener</span><span style="color:#f92672">(</span>listener<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>

  <span style="color:#75715e">// æ ¹æ®æ¥å£ç±»å‹æ‰¾å‡ºæ‰€æœ‰ç›‘å¬å™¨çš„åç§°ï¼Œå…ˆæ³¨å†Œ ApplicationListener çš„åç§°ï¼Œè€Œéå®ä¾‹ï¼Œæ­¤æ—¶ Bean è¿˜æ²¡æœ‰åˆå§‹åŒ–
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// ä¹‹å postProcessor ä¼šæ ¹æ®åå­—åˆå§‹åŒ– Bean çš„å®ä¾‹
</span><span style="color:#75715e"></span>  String<span style="color:#f92672">[]</span> listenerBeanNames <span style="color:#f92672">=</span> getBeanNamesForType<span style="color:#f92672">(</span>ApplicationListener<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String listenerBeanName <span style="color:#f92672">:</span> listenerBeanNames<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    getApplicationEventMulticaster<span style="color:#f92672">().</span><span style="color:#a6e22e">addApplicationListenerBean</span><span style="color:#f92672">(</span>listenerBeanName<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>

  <span style="color:#75715e">// å‘å¸ƒ æ—©æœŸ application events  äº‹ä»¶
</span><span style="color:#75715e"></span>  Set<span style="color:#f92672">&lt;</span>ApplicationEvent<span style="color:#f92672">&gt;</span> earlyEventsToProcess <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">earlyApplicationEvents</span><span style="color:#f92672">;</span>
  <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">earlyApplicationEvents</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>earlyEventsToProcess <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>ApplicationEvent earlyEvent <span style="color:#f92672">:</span> earlyEventsToProcess<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      getApplicationEventMulticaster<span style="color:#f92672">().</span><span style="color:#a6e22e">multicastEvent</span><span style="color:#f92672">(</span>earlyEvent<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="finishbeanfactoryinitialization-">finishBeanFactoryInitialization â¤</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">finishBeanFactoryInitialization</span><span style="color:#f92672">(</span>ConfigurableListableBeanFactory beanFactory<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// å®ä¾‹åŒ– ConversionServiceï¼Œå¹¶ä¿å­˜åœ¨ ApplicationContext ä¸­
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">containsBean</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;conversionService&#34;</span><span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">isTypeMatch</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;conversionService&#34;</span><span style="color:#f92672">,</span> ConversionService<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">setConversionService</span><span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getBean</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;conversionService&#34;</span><span style="color:#f92672">,</span> ConversionService<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">));</span>
   	 <span style="color:#f92672">}</span>

    <span style="color:#75715e">// @since 4.3
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// å¢åŠ å±æ€§è§£æå™¨
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">hasEmbeddedValueResolver</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// @since 3.0
</span><span style="color:#75715e"></span>        beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">addEmbeddedValueResolver</span><span style="color:#f92672">(</span>strVal <span style="color:#f92672">-&gt;</span> getEnvironment<span style="color:#f92672">().</span><span style="color:#a6e22e">resolvePlaceholders</span><span style="color:#f92672">(</span>strVal<span style="color:#f92672">));</span>
   	 <span style="color:#f92672">}</span>

    <span style="color:#75715e">// å®ä¾‹åŒ– LoadTimeWeaverAware æ¥å£çš„ beanï¼Œç”¨äº ApsectJ çš„ç±»åŠ è½½æœŸç»‡å…¥çš„å¤„ç†
</span><span style="color:#75715e"></span>    String<span style="color:#f92672">[]</span> weaverAwareNames <span style="color:#f92672">=</span> beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getBeanNamesForType</span><span style="color:#f92672">(</span>LoadTimeWeaverAware<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String weaverAwareName <span style="color:#f92672">:</span> weaverAwareNames<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        getBean<span style="color:#f92672">(</span>weaverAwareName<span style="color:#f92672">);</span>
   	 <span style="color:#f92672">}</span>
    <span style="color:#75715e">// load-time weaving æ—¶ä¼šç”¨åˆ°ï¼Œè¿™é‡Œå»æ‰  ä¸´æ—¶ ClassLoader
</span><span style="color:#75715e"></span>    beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">setTempClassLoader</span><span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>

    <span style="color:#75715e">// å†»ç»“åŠ è½½çš„ Bean  Name ( DefaultListableBeanFactory )
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// this.configurationFrozen = true;
</span><span style="color:#75715e"></span>	   <span style="color:#75715e">// this.frozenBeanDefinitionNames = StringUtils.toStringArray(this.beanDefinitionNames);
</span><span style="color:#75715e"></span>    beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">freezeConfiguration</span><span style="color:#f92672">();</span>

    <span style="color:#75715e">// ã€Œâ¤â¤â¤ã€å®ä¾‹åŒ–æ‰€æœ‰éæ‡’åŠ è½½çš„ å•ä¾‹Beanã€Œâ¤â¤â¤ã€
</span><span style="color:#75715e"></span>    beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">preInstantiateSingletons</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="preinstantiatesingletons">preInstantiateSingletons</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">preInstantiateSingletons</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> BeansException <span style="color:#f92672">{</span>
  <span style="color:#75715e">//...
</span><span style="color:#75715e"></span>  List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> beanNames <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ArrayList<span style="color:#f92672">&lt;&gt;(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">beanDefinitionNames</span><span style="color:#f92672">);</span>
  <span style="color:#75715e">// è§¦å‘åˆå§‹åŒ– æ‰€æœ‰çš„ non-lazy singleton beans
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String beanName <span style="color:#f92672">:</span> beanNames<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// â¤â¤â¤â¤â¤
</span><span style="color:#75715e"></span>    RootBeanDefinition bd <span style="color:#f92672">=</span> getMergedLocalBeanDefinition<span style="color:#f92672">(</span>beanName<span style="color:#f92672">);</span>
    <span style="color:#75715e">//  éæŠ½è±¡ &amp;&amp; å•ä¾‹ &amp;&amp; éæ‡’åŠ è½½
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>bd<span style="color:#f92672">.</span><span style="color:#a6e22e">isAbstract</span><span style="color:#f92672">()</span> <span style="color:#f92672">&amp;&amp;</span> bd<span style="color:#f92672">.</span><span style="color:#a6e22e">isSingleton</span><span style="color:#f92672">()</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>bd<span style="color:#f92672">.</span><span style="color:#a6e22e">isLazyInit</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
      <span style="color:#75715e">// 
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>isFactoryBean<span style="color:#f92672">(</span>beanName<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// &amp;beanName
</span><span style="color:#75715e"></span>        Object bean <span style="color:#f92672">=</span> getBean<span style="color:#f92672">(</span>FACTORY_BEAN_PREFIX <span style="color:#f92672">+</span> beanName<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>bean <span style="color:#66d9ef">instanceof</span> FactoryBean<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
          <span style="color:#f92672">...</span>
          <span style="color:#75715e">// FactoryBean æ˜¯å¦æ˜¯ SmartFactoryBean.isEagerInit
</span><span style="color:#75715e"></span>          <span style="color:#75715e">// å¦‚æœ isEagerInit é€šè¿‡ getBean æ¥è§¦å‘ Bean çš„å®ä¾‹åŒ–
</span><span style="color:#75715e"></span>          <span style="color:#75715e">// â¤â¤â¤â¤â¤ FactoryBean å¹¶ä¸ä¼šè¢«åˆå§‹åŒ–
</span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span>
      <span style="color:#f92672">}</span>  <span style="color:#75715e">//  isFactoryBean(beanName)
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// â¤â¤â¤â¤â¤ é€šè¿‡ getBean æ¥è§¦å‘ Bean çš„å®ä¾‹åŒ–
</span><span style="color:#75715e"></span>        getBean<span style="color:#f92672">(</span>beanName<span style="color:#f92672">);</span>
      <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span> <span style="color:#75715e">//  !bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit()
</span><span style="color:#75715e"></span>  <span style="color:#f92672">}</span>

  <span style="color:#75715e">// @since 4.1 SmartInitializingSingleton#afterSingletonsInstantiated
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// æ ‡è®°æ¥å£ï¼Œåœ¨å•ä¾‹ Bean åˆå§‹åŒ–ä¹‹åè°ƒç”¨
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String beanName <span style="color:#f92672">:</span> beanNames<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    Object singletonInstance <span style="color:#f92672">=</span> getSingleton<span style="color:#f92672">(</span>beanName<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>singletonInstance <span style="color:#66d9ef">instanceof</span> SmartInitializingSingleton<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">final</span> SmartInitializingSingleton smartSingleton <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>SmartInitializingSingleton<span style="color:#f92672">)</span> singletonInstance<span style="color:#f92672">;</span>
      <span style="color:#f92672">...</span> 
      <span style="color:#75715e">// smartSingleton.afterSingletonsInstantiated();
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="finishrefresh">finishRefresh</h2>
<p>applicationContext åˆ·æ–°å®Œæˆåçš„å¤„ç†ï¼Œä¾‹å¦‚ç”Ÿå‘½å‘¨æœŸç›‘å¬å™¨çš„å›è°ƒï¼Œå¹¿æ’­é€šçŸ¥ç­‰</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">finishRefresh</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">//  @since 5.0 
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// æ¸…é™¤åœ¨èµ„æºåŠ è½½è¿‡ç¨‹ä¸­çš„ç¼“å­˜
</span><span style="color:#75715e"></span>    clearResourceCaches<span style="color:#f92672">();</span>

    <span style="color:#75715e">// æ£€æŸ¥æ˜¯å¦å·²ç»é…ç½®äº†ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨ï¼Œå¦‚æœæ²¡æœ‰å°± new DefaultLifecycleProcessor
</span><span style="color:#75715e"></span>    initLifecycleProcessor<span style="color:#f92672">();</span>

    <span style="color:#75715e">// æ‰¾åˆ°æ‰€æœ‰å®ç°äº† Lifecycle æ¥å£çš„ Beanï¼ŒæŒ‰ç…§æ¯ä¸ª beanè®¾ç½®çš„ç”Ÿå‘½å‘¨æœŸé˜¶æ®µè¿›è¡Œåˆ†ç»„ï¼Œ
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// å†ä¾æ¬¡è°ƒç”¨æ¯ä¸ªåˆ†ç»„ä¸­æ¯ä¸ª Bean çš„ start æ–¹æ³•
</span><span style="color:#75715e"></span>    getLifecycleProcessor<span style="color:#f92672">().</span><span style="color:#a6e22e">onRefresh</span><span style="color:#f92672">();</span>

    <span style="color:#75715e">// å‘å¸ƒ ContextRefreshedEvent äº‹ä»¶ï¼Œäº¤ç»™å¹¿æ’­å™¨å»å¹¿æ’­
</span><span style="color:#75715e"></span>    publishEvent<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ContextRefreshedEvent<span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">));</span>

    <span style="color:#75715e">// å¦‚æœ Environment ä¸­æœ‰ spring.liveBeansView.mbeanDomain  é…ç½®
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// å°±åœ¨ MBeanServer ä¸Šçš„æ³¨å†Œ LiveBeansViewï¼ˆConfigurableApplicationContextï¼‰
</span><span style="color:#75715e"></span>    LiveBeansView<span style="color:#f92672">.</span><span style="color:#a6e22e">registerApplicationContext</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="initlifecycleprocessor">initLifecycleProcessor</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">initLifecycleProcessor</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  ConfigurableListableBeanFactory beanFactory <span style="color:#f92672">=</span> getBeanFactory<span style="color:#f92672">();</span>
  <span style="color:#75715e">// lifecycleProcessor
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">containsLocalBean</span><span style="color:#f92672">(</span>LIFECYCLE_PROCESSOR_BEAN_NAME<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
     <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">lifecycleProcessor</span> <span style="color:#f92672">=</span> beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getBean</span><span style="color:#f92672">(</span>LIFECYCLE_PROCESSOR_BEAN_NAME<span style="color:#f92672">,</span> LifecycleProcessor<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
     <span style="color:#f92672">...</span>
   <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
    DefaultLifecycleProcessor defaultProcessor <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DefaultLifecycleProcessor<span style="color:#f92672">();</span>
    defaultProcessor<span style="color:#f92672">.</span><span style="color:#a6e22e">setBeanFactory</span><span style="color:#f92672">(</span>beanFactory<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">lifecycleProcessor</span> <span style="color:#f92672">=</span> defaultProcessor<span style="color:#f92672">;</span>
    beanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">registerSingleton</span><span style="color:#f92672">(</span>LIFECYCLE_PROCESSOR_BEAN_NAME<span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">lifecycleProcessor</span><span style="color:#f92672">);</span>
     <span style="color:#f92672">...</span>
   <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="destroybeans">destroyBeans()</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroyBeans</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  getBeanFactory<span style="color:#f92672">().</span><span style="color:#a6e22e">destroySingletons</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// DefaultSingletonBeanRegistry
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroySingletons</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
 <span style="color:#f92672">...</span>
  <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">singletonObjects</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">singletonsCurrentlyInDestruction</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
   <span style="color:#f92672">}</span>

  String<span style="color:#f92672">[]</span> disposableBeanNames<span style="color:#f92672">;</span>
  <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">disposableBeans</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    disposableBeanNames <span style="color:#f92672">=</span> StringUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">toStringArray</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">disposableBeans</span><span style="color:#f92672">.</span><span style="color:#a6e22e">keySet</span><span style="color:#f92672">());</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> disposableBeanNames<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span> <span style="color:#f92672">-</span> 1<span style="color:#f92672">;</span> i <span style="color:#f92672">&gt;=</span> 0<span style="color:#f92672">;</span> i<span style="color:#f92672">--)</span> <span style="color:#f92672">{</span>
    destroySingleton<span style="color:#f92672">(</span>disposableBeanNames<span style="color:#f92672">[</span>i<span style="color:#f92672">]);</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">containedBeanMap</span><span style="color:#f92672">.</span><span style="color:#a6e22e">clear</span><span style="color:#f92672">();</span>
  <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dependentBeanMap</span><span style="color:#f92672">.</span><span style="color:#a6e22e">clear</span><span style="color:#f92672">();</span>
  <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dependenciesForBeanMap</span><span style="color:#f92672">.</span><span style="color:#a6e22e">clear</span><span style="color:#f92672">();</span>

  clearSingletonCache<span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>

<span style="color:#75715e">// DefaultSingletonBeanRegistry (org.springframework.beans.factory.support)
</span><span style="color:#75715e">// |--FactoryBeanRegistrySupport (org.springframework.beans.factory.support)
</span><span style="color:#75715e">// |--|--AbstractBeanFactory (org.springframework.beans.factory.support)
</span><span style="color:#75715e">// |--|--|--AbstractAutowireCapableBeanFactory (org.springframework.beans.factory.support)
</span><span style="color:#75715e">// |--|--|--|--DefaultListableBeanFactory (org.springframework.beans.factory.support)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroySingletons</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">super</span><span style="color:#f92672">.</span><span style="color:#a6e22e">destroySingletons</span><span style="color:#f92672">();</span>
  updateManualSingletonNames<span style="color:#f92672">(</span>Set<span style="color:#f92672">::</span>clear<span style="color:#f92672">,</span> set <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">!</span>set<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">());</span>
  clearByTypeCache<span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="destroysingleton">destroySingleton</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroySingleton</span><span style="color:#f92672">(</span>String beanName<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// Remove a registered singleton of the given name, if any.
</span><span style="color:#75715e"></span>    removeSingleton<span style="color:#f92672">(</span>beanName<span style="color:#f92672">);</span>

    <span style="color:#75715e">// Destroy the corresponding DisposableBean instance.
</span><span style="color:#75715e"></span>    DisposableBean disposableBean<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">disposableBeans</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      disposableBean <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>DisposableBean<span style="color:#f92672">)</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">disposableBeans</span><span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>beanName<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    destroyBean<span style="color:#f92672">(</span>beanName<span style="color:#f92672">,</span> disposableBean<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="destroybean">destroyBean</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroyBean</span><span style="color:#f92672">(</span>String beanName<span style="color:#f92672">,</span> <span style="color:#a6e22e">@Nullable</span> DisposableBean bean<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">// Trigger destruction of dependent beans first...
</span><span style="color:#75715e"></span>  Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> dependencies<span style="color:#f92672">;</span>
  <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dependentBeanMap</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// Within full synchronization in order to guarantee a disconnected Set
</span><span style="color:#75715e"></span>    dependencies <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dependentBeanMap</span><span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>beanName<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>dependencies <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>logger<span style="color:#f92672">.</span><span style="color:#a6e22e">isTraceEnabled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
      logger<span style="color:#f92672">.</span><span style="color:#a6e22e">trace</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Retrieved dependent beans for bean &#39;&#34;</span> <span style="color:#f92672">+</span> beanName <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#39;: &#34;</span> <span style="color:#f92672">+</span> dependencies<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String dependentBeanName <span style="color:#f92672">:</span> dependencies<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      destroySingleton<span style="color:#f92672">(</span>dependentBeanName<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>

  <span style="color:#75715e">// Actually destroy the bean now...
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>bean <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
      <span style="color:#75715e">// â¤â¤â¤ â¤â¤â¤
</span><span style="color:#75715e"></span>      bean<span style="color:#f92672">.</span><span style="color:#a6e22e">destroy</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>Throwable ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>logger<span style="color:#f92672">.</span><span style="color:#a6e22e">isWarnEnabled</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        logger<span style="color:#f92672">.</span><span style="color:#a6e22e">warn</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Destruction of bean with name &#39;&#34;</span> <span style="color:#f92672">+</span> beanName <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;&#39; threw an exception&#34;</span><span style="color:#f92672">,</span> ex<span style="color:#f92672">);</span>
      <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>

  <span style="color:#75715e">// Trigger destruction of contained beans...
</span><span style="color:#75715e"></span>  Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> containedBeans<span style="color:#f92672">;</span>
  <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">containedBeanMap</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// Within full synchronization in order to guarantee a disconnected Set
</span><span style="color:#75715e"></span>    containedBeans <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">containedBeanMap</span><span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>beanName<span style="color:#f92672">);</span>
  <span style="color:#f92672">}</span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>containedBeans <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>String containedBeanName <span style="color:#f92672">:</span> containedBeans<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
      destroySingleton<span style="color:#f92672">(</span>containedBeanName<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>

  <span style="color:#75715e">// Remove destroyed bean from other beans&#39; dependencies.
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dependentBeanMap</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>Iterator<span style="color:#f92672">&lt;</span>Map<span style="color:#f92672">.</span><span style="color:#a6e22e">Entry</span><span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;&gt;&gt;</span> it <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dependentBeanMap</span><span style="color:#f92672">.</span><span style="color:#a6e22e">entrySet</span><span style="color:#f92672">().</span><span style="color:#a6e22e">iterator</span><span style="color:#f92672">();</span> it<span style="color:#f92672">.</span><span style="color:#a6e22e">hasNext</span><span style="color:#f92672">();)</span> <span style="color:#f92672">{</span>
      Map<span style="color:#f92672">.</span><span style="color:#a6e22e">Entry</span><span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;&gt;</span> entry <span style="color:#f92672">=</span> it<span style="color:#f92672">.</span><span style="color:#a6e22e">next</span><span style="color:#f92672">();</span>
      Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> dependenciesToClean <span style="color:#f92672">=</span> entry<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">();</span>
      dependenciesToClean<span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>beanName<span style="color:#f92672">);</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>dependenciesToClean<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        it<span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">();</span>
      <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>

  <span style="color:#75715e">// Remove destroyed bean&#39;s prepared dependency information.
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dependenciesForBeanMap</span><span style="color:#f92672">.</span><span style="color:#a6e22e">remove</span><span style="color:#f92672">(</span>beanName<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="cancelrefreshex">cancelRefresh(ex)</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">cancelRefresh</span><span style="color:#f92672">(</span>BeansException ex<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">active</span><span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="resetcommoncaches">resetCommonCaches()</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">resetCommonCaches</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    ReflectionUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">clearCache</span><span style="color:#f92672">();</span>
    AnnotationUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">clearCache</span><span style="color:#f92672">();</span>
    ResolvableType<span style="color:#f92672">.</span><span style="color:#a6e22e">clearCache</span><span style="color:#f92672">();</span>
    CachedIntrospectionResults<span style="color:#f92672">.</span><span style="color:#a6e22e">clearClassLoader</span><span style="color:#f92672">(</span>getClassLoader<span style="color:#f92672">());</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="å°ç»“">å°ç»“</h2>
<p><code>refresh</code> çš„è¿‡ç¨‹ä¸­æœ‰å‡ ä¸ªå…³é”®æµç¨‹</p>
<ul>
<li><code>prepareRefresh</code> åˆå§‹åŒ– <strong><code>Environment</code></strong></li>
<li><code>obtainFreshBeanFactory</code> é€šçŸ¥å­ç±» <strong>æ‰«æè§£æBean</strong></li>
<li><code>invokeBeanFactoryPostProcessors</code> è°ƒç”¨ <strong><code>BeanFactoryPostProcessor</code></strong>ï¼Œ å¯å¯¹æ‰«æåˆ°çš„ <code>BeanDefinition</code> è¿›è¡Œä¿®æ”¹æˆ–å®šä¹‰</li>
<li>æœ€å <code>finishBeanFactoryInitialization</code> é€šè¿‡ <strong><code>getBean</code> çš„æ–¹å¼å®ä¾‹åŒ–å•ä¾‹çš„ Bean</strong></li>
</ul>
<h2 id="read-more">Read More</h2>
<ul>
<li>
  <a href="https://blog.csdn.net/boling_cavalry/article/details/80957707">Spring åˆå§‹åŒ–æºç å­¦ä¹ ä¸‰éƒ¨æ›²ä¹‹ä¸€ï¼šAbstractApplicationContext æ„é€ æ–¹æ³•</a></li>
<li>
  <a href="https://blog.csdn.net/boling_cavalry/article/details/80958832">Spring åˆå§‹åŒ–æºç å­¦ä¹ ä¸‰éƒ¨æ›²ä¹‹äºŒï¼šsetConfigLocations æ–¹æ³•</a></li>
<li>
  <a href="https://blog.csdn.net/boling_cavalry/article/details/81045637">Spring åˆå§‹åŒ–æºç å­¦ä¹ ä¸‰éƒ¨æ›²ä¹‹ä¸‰ï¼šAbstractApplicationContext.refresh æ–¹æ³•</a></li>
</ul>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex justify-between">



  <div>
    
    <a class="flex align-center" href="https://github.com/hello-world-example/Spring-Context/commit/a174fe779b22eb663e0e776b36a49dd9abc195be" title='Last modified by kaibin.yang | Feb 10, 2021' target="_blank" rel="noopener">
      <img src="/Spring-Context/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>Feb 10, 2021</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/hello-world-example/Spring-Context/edit/master/HuGo/content/docs/spring-context/ConfigurableApplicationContext.md" target="_blank" rel="noopener">
      <img src="/Spring-Context/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>

</div>

 
        
<script>
var images = document.getElementsByTagName("img")
console.info(images.length)
for(var i=0; i<images.length; i++){
  var image = images[i]
  var src = image.getAttribute("src");
  if(src.startsWith("-images")){
    image.setAttribute("src", "../" + src)
  }
}
</script>

      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#configurableapplicationcontextrefresh">ConfigurableApplicationContext.refresh</a>
      <ul>
        <li><a href="#ç»§æ‰¿å…³ç³»">ç»§æ‰¿å…³ç³»</a></li>
        <li><a href="#å®ç°å…³ç³»">å®ç°å…³ç³»</a></li>
        <li><a href="#abstractapplicationcontext">AbstractApplicationContext</a></li>
        <li><a href="#-refresh">â¤ refresh()</a></li>
        <li><a href="#preparerefresh-">prepareRefresh() â¤</a></li>
        <li><a href="#obtainfreshbeanfactory-">obtainFreshBeanFactory() â¤</a>
          <ul>
            <li><a href="#absrefreshableacrefreshbeanfactory">Abs..RefreshableA..C&hellip;refreshBeanFactory()</a></li>
          </ul>
        </li>
        <li><a href="#preparebeanfactory">prepareBeanFactory</a></li>
        <li><a href="#postprocessbeanfactory">postProcessBeanFactory</a>
          <ul>
            <li><a href="#staticwebapplicationcontextspring-web">StaticWebApplicationContext:spring-web</a></li>
            <li><a href="#genericwebapplicationcontextspring-web">GenericWebApplicationContext:spring-web</a></li>
            <li><a href="#abstractrefreshablewebapplicationcontextspring-web">AbstractRefreshableWebApplicationContext:spring-web</a></li>
          </ul>
        </li>
        <li><a href="#invokebeanfactorypostprocessors-">invokeBeanFactoryPostProcessors â¤</a></li>
        <li><a href="#registerbeanpostprocessors">registerBeanPostProcessors</a>
          <ul>
            <li><a href="#registerbeanpostprocessors-1">registerBeanPostProcessorsï¼Ÿï¼Ÿï¼Ÿ</a></li>
          </ul>
        </li>
        <li><a href="#initmessagesource">initMessageSource</a></li>
        <li><a href="#initapplicationeventmulticaster">initApplicationEventMulticaster</a></li>
        <li><a href="#onrefresh">onRefresh</a></li>
        <li><a href="#registerlisteners">registerListeners()</a></li>
        <li><a href="#finishbeanfactoryinitialization-">finishBeanFactoryInitialization â¤</a>
          <ul>
            <li><a href="#preinstantiatesingletons">preInstantiateSingletons</a></li>
          </ul>
        </li>
        <li><a href="#finishrefresh">finishRefresh</a>
          <ul>
            <li><a href="#initlifecycleprocessor">initLifecycleProcessor</a></li>
          </ul>
        </li>
        <li><a href="#destroybeans">destroyBeans()</a>
          <ul>
            <li><a href="#destroysingleton">destroySingleton</a></li>
            <li><a href="#destroybean">destroyBean</a></li>
          </ul>
        </li>
        <li><a href="#cancelrefreshex">cancelRefresh(ex)</a></li>
        <li><a href="#resetcommoncaches">resetCommonCaches()</a></li>
        <li><a href="#å°ç»“">å°ç»“</a></li>
        <li><a href="#read-more">Read More</a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












